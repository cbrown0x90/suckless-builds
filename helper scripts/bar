#!/bin/bash

# Ethernet
eth_state="$(cat /sys/class/net/enp0s25/operstate)"
eth_ip=$(ip -o -4 addr show dev enp0s25 | awk -F '[ /]+' '/global/ {print $4}')
if [ "$eth_state" = "up" ]; then
    ETH=$eth_ip
else
    ETH="No IP"
fi

# Wireless
wlan_state="$(cat /sys/class/net/wlp3s0/operstate)"
wlan_ip=$(ip -o -4 addr show dev wlp3s0 | awk -F '[ /]+' '/global/ {print $4}')
if [ "$wlan_state" = "up" ]; then
    WLAN=$wlan_ip
else
    WLAN="No IP"
fi

# Battery
BAT_STATE=$(acpi | awk '{print substr($3, 0, length($3)-1)}')
BAT_RAW=$(acpi | awk '{print substr($4, 0, length($4)-2)}')
if [[ "$BAT_STATE" == "Charging" ]]; then
    BAT=" $BAT_RAW%"
elif [[ "$BAT_STATE" == "Full" ]]; then
    BAT=" Capacity"
elif [[ "$BAT_STATE" == "Discharging" ]]; then
    if [[ "$BAT_RAW" -lt "20" ]]; then
        BAT=" $BAT_RAW%"
    elif [[ "$BAT_RAW" -lt "40" ]]; then
        BAT=" $BAT_RAW%"
    elif [[ "$BAT_RAW" -lt "60" ]]; then
        BAT=" $BAT_RAW%"
    elif [[ "$BAT_RAW" -lt "85" ]]; then
        BAT=" $BAT_RAW%"
    else
        BAT=" $BAT_RAW%"
    fi
fi

# Time
DATE=$( date +"%F %T")

# Audio
AUDIO_STATE=$(amixer sget Master | egrep -m 1 'Playback.*?\[o' | egrep -o '\[o.+\]')
RAW_AUDIO=$(amixer sget Master | egrep -o -m 1 "[0-9]+"% | awk '{print substr($0, 0, length($0)-1)}')
if [[ $AUDIO_STATE == '[off]' ]]; then
    AUDIO=" Muted"
elif [[ $RAW_AUDIO == 0 ]]; then
    AUDIO=" "$RAW_AUDIO%
elif [[ $RAW_AUDIO -lt 51 ]]; then
    AUDIO=" "$RAW_AUDIO%
else
    AUDIO=" "$RAW_AUDIO%
fi

# HDD
DRIVE="${BLOCK_INSTANCE:-$HOME}"
SPACE=$(df -h -P -l "$DRIVE" | awk '/\/.*/ {print $4
    use=$5
}')

# Brightness
BRIGHTNESS=$(cat /sys/class/backlight/intel_backlight/brightness)%

#PRINT
echo " "$SPACE "| " $ETH "| " $WLAN "|" $BAT "| " $BRIGHTNESS" |" $AUDIO "|" $DATE
